{%- comment -%}
    It creates a style tag and it restricts an image from growing larger than its max resolution.
    Accepts:
    - image: {Object} Image object
    - max_width: {Number} Max width of the image container
    - max_height: {Number} Max height of the image container
    - image_width: {Number} image width
    - image_height: {Number} image height
    - alt: {String} image alt text
    - aspect_ratio: aspect ratio of the image (width/height)
    - image_size: image size
    - image_class: {String} class name of the <img />
    - overlay: {Bool} overlay of the <div> wrapper (after)
    - image_attributes: {String}  additional HTML attributes of the <img />
    - wrapper_class: {String} class name of the <div> wrapper
    - wrapper_attributes: {String} additional HTML attributes of the <div> wrapper
    Usage:
    In your liquid template file, copy the following line
    - {% include 'responsive-image' with image: featured_image, image_class: "css-class", wrapper_class: "wrapper-css-class", max_width: 700, max_height: 800 %}
{%- endcomment -%}

{% liquid
	if image == blank
		assign aspect_ratio = aspect_ratio | default: '16/9'
		if aspect_ratio == 'original'
			assign aspect_ratio = '16/9'
		endif
	endif

	if overlay == blank
		assign overlay = false
	endif

	if image_size == blank or image_size == 'full'
		assign image_size = '100vw'
	endif
%}

{%- capture style -%}
	{% assign asp_rat_default = image.aspect_ratio | default: '16/9' %}
	{% assign asp_rat = aspect_ratio | default: asp_rat_default %}
	{% if asp_rat != 'none' %}
		{%- if asp_rat == 'original' %}
			--aspect-ratio: {{ asp_rat_default }};
		{%- else %}
			--aspect-ratio: {{ asp_rat }};
		{% endif -%}
	{% endif %}
	{%- if aspect_ratio_on_tablet %}
		--aspect-ratio-tablet: {{ aspect_ratio_on_tablet }};
	{% endif -%}
	{%- if aspect_ratio_on_mobile %}
		--aspect-ratio-mobile: {{ aspect_ratio_on_mobile }};
	{% endif -%}
	{%- if max_width != blank and max_width != 0 %}
		--image-width: {{ max_width }};
	{% endif -%}
	{%- if image_height != blank and image_height != 0 %}
		--image-height: {{ image_height }};
	{% endif -%}
	{%- if image_width != blank and image_width != 0 %}
		--image-width: {{ image_width }};
	{% endif -%}
{%- endcapture -%}
<div
	class="gsp-image {%- if overlay %} gsp-img-overlay {% endif -%}  {%- if image == blank %} gsp-image__placeholder {% endif %} {{ wrapper_class }}" {{ wrapper_attributes }}
	style="{{ style | strip | strip_newlines }}">
	{% if image == blank %}
		{{ placeholder | placeholder_svg_tag }}
	{% else %}
		<img srcset="{%- if image.width >= 165 -%}{{ image | image_url: width: 165 }} 165w,{%- endif -%}
          {%- if image.width >= 360 -%}{{ image | image_url: width: 360 }} 360w,{%- endif -%}
          {%- if image.width >= 533 -%}{{ image | image_url: width: 533 }} 533w,{%- endif -%}
          {%- if image.width >= 720 -%}{{ image | image_url: width: 720 }} 720w,{%- endif -%}
          {%- if image.width >= 940 -%}{{ image | image_url: width: 940 }} 940w,{%- endif -%}
          {%- if image.width >= 1066 -%}{{ image | image_url: width: 1066 }} 1066w,{%- endif -%}
          {%- if image.width >= 1500 -%}{{ image | image_url: width: 1500 }} 1500w,{%- endif -%}
          {%- if image.width >= 1780 -%}{{ image | image_url: width: 1780 }} 1780w,{%- endif -%}
          {%- if image.width >= 2000 -%}{{ image | image_url: width: 2000 }} 2000w,{%- endif -%}
          {{ image | image_url }} {{ image.width }}w"
			 src="{{ image | image_url: width: 360 }}"
			 sizes="{{ image_size }}"
			 alt="{{ alt | default: image.alt | escape }}"
			{% unless lazy_load == false %}loading="lazy"{% endunless %}
			 class="{{ image_class }}"
			 width="{{ image.width }}"
			 height="{{ image.height }}"
			{{ image_attributes }}>
	{% endif %}
</div>